# Cheking if a 4x4 Mueller matrix is positive-semidefinite using the Descartes rule of signs applied
# to the characteristic polynomial of the matrix.

# The coefficients of the characteristic polynomial are written explicitly and were
# pre-computed and simplified in Maple. In these formulas, the function H is applied first
# and then the positive-semidefiniteness of H(M) is assessed. 

function C1(M)
  return 4*M[1,1]
end

function C2(M)
  return 6*M[1,1]^2-2*M[1,2]^2-2*M[1,3]^2-2*M[1,4]^2-2*M[2,1]^2-2*M[2,2]^2-2*M[2,3]^2-2*M[2,4]^2-2*M[3,1]^2-2*M[3,2]^2-2*M[3,3]^2-2*M[3,4]^2-2*M[4,1]^2-2*M[4,2]^2-2*M[4,3]^2-2*M[4,4]^2
end

function C3(M)
  return 4*M[1,1]^3+(-4*M[1,2]^2-4*M[1,3]^2-4*M[1,4]^2-4*M[2,1]^2-4*M[2,2]^2-4*M[2,3]^2-4*M[2,4]^2-4*M[3,1]^2-4*M[3,2]^2-4*M[3,3]^2-4*M[3,4]^2-4*M[4,1]^2-4*M[4,2]^2-4*M[4,3]^2-4*M[4,4]^2)*M[1,1]+(8*M[2,1]*M[2,2]+8*M[3,1]*M[3,2]+8*M[4,1]*M[4,2])*M[1,2]+(8*M[2,1]*M[2,3]+8*M[3,1]*M[3,3]+8*M[4,1]*M[4,3])*M[1,3]+(8*M[2,1]*M[2,4]+8*M[3,1]*M[3,4]+8*M[4,1]*M[4,4])*M[1,4]+(8*M[3,3]*M[4,4]-8*M[3,4]*M[4,3])*M[2,2]+(-8*M[3,2]*M[4,4]+8*M[3,4]*M[4,2])*M[2,3]+8*M[2,4]*(M[3,2]*M[4,3]-M[3,3]*M[4,2])
end

function C4(M)
  return M[1,1]^4+M[1,2]^4+M[1,3]^4+M[2,1]^4+M[2,2]^4+M[2,3]^4+M[3,1]^4+M[3,2]^4+M[3,3]^4+M[1,4]^4+M[2,4]^4+M[3,4]^4+8*M[3,3]*M[3,4]*M[4,3]*M[4,4]-8*M[4,1]*(M[3,2]*M[4,2]+M[3,3]*M[4,3]+M[3,4]*M[4,4])*M[3,1]+8*M[4,2]*(M[3,3]*M[4,3]+M[3,4]*M[4,4])*M[3,2]+8*M[2,4]*(M[3,3]*M[3,4]+M[4,3]*M[4,4])*M[2,3]+(M[4,1]^2-M[4,2]^2-M[4,3]^2-M[4,4]^2)^2+(2*M[4,1]^2-2*M[4,2]^2-2*M[4,3]^2+2*M[4,4]^2)*M[3,4]^2+(2*M[3,4]^2+2*M[4,1]^2-2*M[4,2]^2+2*M[4,3]^2-2*M[4,4]^2)*M[3,3]^2+(2*M[3,3]^2+2*M[3,4]^2+2*M[4,1]^2+2*M[4,2]^2-2*M[4,3]^2-2*M[4,4]^2)*M[3,2]^2+(-2*M[3,2]^2-2*M[3,3]^2-2*M[3,4]^2+2*M[4,1]^2+2*M[4,2]^2+2*M[4,3]^2+2*M[4,4]^2)*M[3,1]^2+(2*M[3,1]^2-2*M[3,2]^2-2*M[3,3]^2+2*M[3,4]^2+2*M[4,1]^2-2*M[4,2]^2-2*M[4,3]^2+2*M[4,4]^2)*M[2,4]^2+(2*M[2,4]^2+2*M[3,1]^2-2*M[3,2]^2+2*M[3,3]^2-2*M[3,4]^2+2*M[4,1]^2-2*M[4,2]^2+2*M[4,3]^2-2*M[4,4]^2)*M[2,3]^2+((8*M[3,2]*M[3,3]+8*M[4,2]*M[4,3])*M[2,3]+8*M[2,4]*(M[3,2]*M[3,4]+M[4,2]*M[4,4]))*M[2,2]+(2*M[2,3]^2+2*M[2,4]^2+2*M[3,1]^2+2*M[3,2]^2-2*M[3,3]^2-2*M[3,4]^2+2*M[4,1]^2+2*M[4,2]^2-2*M[4,3]^2-2*M[4,4]^2)*M[2,2]^2+((-8*M[3,1]*M[3,2]-8*M[4,1]*M[4,2])*M[2,2]+(-8*M[3,1]*M[3,3]-8*M[4,1]*M[4,3])*M[2,3]-8*M[2,4]*(M[3,1]*M[3,4]+M[4,1]*M[4,4]))*M[2,1]+(-2*M[2,2]^2-2*M[2,3]^2-2*M[2,4]^2+2*M[3,1]^2+2*M[3,2]^2+2*M[3,3]^2+2*M[3,4]^2+2*M[4,1]^2+2*M[4,2]^2+2*M[4,3]^2+2*M[4,4]^2)*M[2,1]^2+((-8*M[3,2]*M[4,3]+8*M[3,3]*M[4,2])*M[2,1]+(8*M[3,1]*M[4,3]-8*M[3,3]*M[4,1])*M[2,2]+8*M[2,3]*(-M[3,1]*M[4,2]+M[3,2]*M[4,1]))*M[1,4]+(-2*M[2,1]^2+2*M[2,2]^2+2*M[2,3]^2-2*M[2,4]^2-2*M[3,1]^2+2*M[3,2]^2+2*M[3,3]^2-2*M[3,4]^2-2*M[4,1]^2+2*M[4,2]^2+2*M[4,3]^2-2*M[4,4]^2)*M[1,4]^2+((-8*M[2,3]*M[2,4]-8*M[3,3]*M[3,4]-8*M[4,3]*M[4,4])*M[1,4]+(8*M[3,2]*M[4,4]-8*M[3,4]*M[4,2])*M[2,1]+(-8*M[3,1]*M[4,4]+8*M[3,4]*M[4,1])*M[2,2]-8*M[2,4]*(-M[3,1]*M[4,2]+M[3,2]*M[4,1]))*M[1,3]+(2*M[1,4]^2-2*M[2,1]^2+2*M[2,2]^2-2*M[2,3]^2+2*M[2,4]^2-2*M[3,1]^2+2*M[3,2]^2-2*M[3,3]^2+2*M[3,4]^2-2*M[4,1]^2+2*M[4,2]^2-2*M[4,3]^2+2*M[4,4]^2)*M[1,3]^2+((-8*M[2,2]*M[2,3]-8*M[3,2]*M[3,3]-8*M[4,2]*M[4,3])*M[1,3]+(-8*M[2,2]*M[2,4]-8*M[3,2]*M[3,4]-8*M[4,2]*M[4,4])*M[1,4]+(-8*M[3,3]*M[4,4]+8*M[3,4]*M[4,3])*M[2,1]+(8*M[3,1]*M[4,4]-8*M[3,4]*M[4,1])*M[2,3]+8*M[2,4]*(-M[3,1]*M[4,3]+M[3,3]*M[4,1]))*M[1,2]+(2*M[1,3]^2+2*M[1,4]^2-2*M[2,1]^2-2*M[2,2]^2+2*M[2,3]^2+2*M[2,4]^2-2*M[3,1]^2-2*M[3,2]^2+2*M[3,3]^2+2*M[3,4]^2-2*M[4,1]^2-2*M[4,2]^2+2*M[4,3]^2+2*M[4,4]^2)*M[1,2]^2+((8*M[2,1]*M[2,2]+8*M[3,1]*M[3,2]+8*M[4,1]*M[4,2])*M[1,2]+(8*M[2,1]*M[2,3]+8*M[3,1]*M[3,3]+8*M[4,1]*M[4,3])*M[1,3]+(8*M[2,1]*M[2,4]+8*M[3,1]*M[3,4]+8*M[4,1]*M[4,4])*M[1,4]+(8*M[3,3]*M[4,4]-8*M[3,4]*M[4,3])*M[2,2]+(-8*M[3,2]*M[4,4]+8*M[3,4]*M[4,2])*M[2,3]+8*M[2,4]*(M[3,2]*M[4,3]-M[3,3]*M[4,2]))*M[1,1]+(-2*M[1,2]^2-2*M[1,3]^2-2*M[1,4]^2-2*M[2,1]^2-2*M[2,2]^2-2*M[2,3]^2-2*M[2,4]^2-2*M[3,1]^2-2*M[3,2]^2-2*M[3,3]^2-2*M[3,4]^2-2*M[4,1]^2-2*M[4,2]^2-2*M[4,3]^2-2*M[4,4]^2)*M[1,1]^2
end

function PSD(M)
  return ((C1(M) >= 0) & (C2(M) >= 0) & (C3(M) >= 0) & (C4(M) >= 0))
end

